# SELinux: проблема с удаленным обновлением зоны DNS
Ссылка на стенд:
https://github.com/mbfx/otus-linux-adm/tree/664cc1de4d02e6fc8a7b44580c7d92dc68ea23f8/selinux_dns_problems

Для начала посмотрим на логи событий на ns01
```cat /var/log/audit/audit.log | audit2why```
В логах мы видим, что ошибка в контексте безопасности. Вместо типа named_t используется тип etc_t.
Исходя из файла настроек /etc/named.conf  мы видим что настройки зон распологаются в каталоге /etc/named, поэтому к нему применяюся контекст безопасности etc_t, поэтому selinux не дает нам доступ
Проверим непосредственно папку, чтоыбы точно убедиться что контекст безопасности не соответсвует для данной службы.
```ls -laZ /etc/named```
Команда показываает стандартное распределение политик по в соотвутствующих деректориях. Исходя из вывода мы понимаем что контекст безопасности named_zone_t отвечающий за работу dns зон соответсвует директории /var/named
```semanage fcontext -l | grep named```

Решения

1) Самое простое это просто отключить selinux
```sed -i 's/^SELINUX=.*/SELINUX=disabled/g' /etc/selinux/config```
Но так как нам важно безопасность?для нас это неприемлимо)

2) Перед настройкой сервера учитывать контекст безопасности selinux и создавать конфигурационный файлы в соответсвующих директориях в данном случае /var/named. По моему мнению это самый лучший вариант т.к. если завести за правило руководствоваться данному прицнипу в будущем не придеться тратить время на поиск возникших несисправностей.
3) Внести изменения в контекст безопасности добавив новые директории:
```semanage fcontext -a -t named_zone_t "/etc/named(/.*)?"```
```restorecon -R -v /etc/named```
4) Просто вручную поменять контекст безопасности:
```chcon -R -t named_zone_t /etc/named```
Вариант имеет недостаток, при изменении меток файловых систем, изменения пропадут.

#### Для подтверждения изменений смотри screenshot.

